### Artem Tkachenko, 2022 fall
#### homework 4, Kubernetes


### Особенности решения

Скрины в папке `/k8s/pics/`


### Комментарии:

0. `kubectl` ставится одновременно с `minikube` (см. следующий пункт).

1. Kubernetes установлен по инструкции https://minikube.sigs.k8s.io/docs/start/ в виртуалке (VMWare) Fedora 36 (host Windows 7).

3. Requests - требования к минимальным ресурсам (cpu, memory, hugepages), необходимым для развертывания pod-а. Параметр позволяет не запускать pod-ы на заведомо неприемлемом "железе".
Limits - ограничение по ресурсам сверху. Параметр позволяет ограничить "прожорливые" pod-ы.

4. Само приложение online_inference стартует быстро, поэтому коды возврата пробников /ready и /health сделаны завимыми от времени начала запуска (изменен файл server.py в рамках данного PR). Состояние READY появляется спустя 30 секунд после начала запуска. Эта задержка предоставляет время для старта тяжелых подов (т.е. с одной стороны не нагружать их работой, с другой стороны не считать их READY).

Через 120 секунд приложение "падает" (пробник /health возвращает ошибку). После этого контроллер(?) убивает pod и поднимает новый. И т.д.

5. Если сменить docker образ в манифесте и одновременно с этим уменьшить число реплик, то число реплик-подов уменьшится и каждая реплика продолжит работать на старой версии образа.

Если же одновременно с этим увеличить число реплик в манифесте, то число реплик-подов увеличится и все новые будут запущены уже на новой версии образа.

6. a) есть момент времени, когда на кластере существуют как все старые поды, так и все новые - это достигается так:

maxSurge: 3
maxUnavailable: 0

т.е. вначале поднимаются новые версии, а потом "гасятся" старые версии.

б) одновременно с поднятием новых версий, гасятся старые:

maxSurge: 1
maxUnavailable: 0

т.е. запуск/"гашение" происходят практически одновременно


### Самооценка

(5/5) 1. Разверните Kubernetes
(4/4) 2. Напишите простой Pod manifest для вашего приложения, назовите его online-inference-pod.yaml
(2/2) 3. Пропишите Requests / Limits и напишите, зачем это нужно в описании PR
(3/3) 4. Модифицируйте свое приложение так, чтобы оно стартовало не сразу (с задержкой 20-30 секунд) и падало спустя минуты работы
(3/3) 5. Сделайте 3 реплики вашего приложения
(3/3) 6. Опишите [Deployment] для вашего приложения

Доп.задания.
(0/5) 7. Установите Helm и оформите Helm chart
(0/5) 8. Разверните kubernetes кластер с помощью terraform

Итого: 20 баллов
